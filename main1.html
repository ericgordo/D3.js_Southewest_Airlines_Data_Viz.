<!DOCTYPE html>
<html lang="en">
	<head>
		<h1>South West in a Leauge of it's Own</h1>
		<h2>A Data Vizualization by Eric Gordon</h2>
		<meta charset="utf-8">
		<title>Flight Vizualization</title>
		<style type="text/css">
		h1 {
      font-size: 36px;
			color: red;
			text-align: center;
    }
		h2 {
      font-size: 24px;
			color: red;
			text-align: center;
    }
		#countainer {
			text-align: center;
		}
		.axis text {
		    font-family: Lato;
		    font-size: 13px;
				}
		div.tooltip {
		    position: absolute;
		    text-align: center;
		    width: 80px;
		    height: 70px;
		    padding: 4px;
		    font: 12px sans-serif;
		    background: lightsteelblue;
		    border: 0px;
		    border-radius: 8px;
		    pointer-events: none;
		}
		</style>
		<script src="http://d3js.org/d3.v3.min.js"></script>
		</script>
	</head>
	<body>

		<div id="container"></div>
		<script type="text/javascript">

		function draw(data){
				//Set Bounds
				var margin = {top: 20, right: 10, bottom: 20, left: 10},
						width = 600 - margin.left - margin.right,
						height = 200 - margin.top - margin.bottom;

				//Create SVG
				var svg = d3.select("#container")
										.append("svg")
										.attr("width", width + margin.left +margin.right)
										.attr("height", height + margin.top + margin.bottom)
										.append("g")
										.attr("class", "chart")
										.attr("transform", "translate(" + margin.left + "," + margin.top + ")");;

				//Title
				svg.append("text")
        		.attr("x", (width / 2))
        		.attr("y", 0 - (margin.top / 2))
       			.attr("text-anchor", "middle")
        		.style("font-size", "20px")
        		.style("text-decoration", "underline")
        		.text("Annual Flights by Carrier");

				//Scales
				var xScale = d3.scale.linear()
													.domain(d3.extent(data, function(d){
														return d["Year"];
													}))
													.range([0, width]);

				var yScale = d3.scale.linear()
												.domain([0,d3.max(data, function(d){
													return d["Flight Count"];
												})])
												.range([height, 0]);

				var xAxis = d3.svg.axis()
										 			.scale(xScale)
													.tickFormat(d3.format("d"));
				var yAxis = d3.svg.axis()
													.scale(yScale)
													.orient("left");

				//Create X axis
				svg.append("g")
				 	.attr("class", "xAxis")
					.attr("class", "axis")
				 	.attr("transform", "translate(0," + height + ")")
				 	.call(xAxis);

				//Create yAxis
			  svg.append("g")
 				 	.attr("class", "yAxis")
 					.attr("class", "axis")
 				 	.call(yAxis);

				//Y Axis Label
				svg.append("text")
					 .attr("class", "y label")
					 .attr("text-anchor", "middle")
					 .text("Number of Flights");

				//X Axis Label
				svg.append("text")
					 .attr("text-anchor", "middle")
					 .attr("class", "x label")
					 .attr("text-anchor", "middle")
					 .attr("transform", "translate("+ (width/2) +","+(height + (margin.bottom))+")")
					 .text("Year");



				//Define Line Creation function
				var line = d3.svg.line()
										.x(function(d) {
											return xScale(d.Year); })
										.y(function(d) {
											return yScale(d["Flight Count"]); });

				//Colors for EACH Carrier
				var colors = d3.scale.category10()
														.domain(d3.values(data, function(d){
															return d["UniqueCarrier"];
														}))

				// Define Data Grouped by Carrier
				var dataGroup=d3.nest()
												.key(function(d){
													return d.UniqueCarrier
												})
												.entries(data);
				//tooltip function
				var div = d3.select("body").append("div")
										.attr("class", "tooltip")
										.style("opacity", 0);



				// Draw Seperate Lines and Circles
				dataGroup.forEach(function(d,i){



									svg.append("path")
										.attr("d", line(d.values))
										.attr("stroke", colors(d.key))
										.attr("stroke-width", 2)
										.attr("class", d.key)
										.attr("fill","none");

										svg.append('g')
												.attr("class", "circle")
												.selectAll("circle")
												.data(d.values)
												.enter()
												.append("circle")
												.attr("cx", function(d){
															 return xScale(d.Year);})
												.attr("cy", function(d){
															 return yScale(d["Flight Count"]);})
												.attr("r", 5)
												.attr("fill", function(d){
													return colors(d.UniqueCarrier);})
												.on("mouseover", function(d) {
													div.transition()
															.duration(200)
															.style("opacity", .9);
													div .html((d.UniqueCarrier)+"<br/>"
													+ "Year: "+ d.Year +"<br/>" +"# of Flights: "+ (d["Flight Count"]))
															.style("left", (d3.event.pageX) + "px")
															.style("top", (d3.event.pageY - 28) + "px");
            							})
												.on("mouseout", function(d){
													div.transition()
															.duration(500)
															.style("opacity", 0);
															});
});

}

d3.csv("final_data.csv",  function(d) {
	      // transform data
	      d['Flight Count'] = +d['Flight Count'];
	      d['Year'] = +d['Year'];
	      return d;
	  }, draw);

		</script>
	</body>
</html>
